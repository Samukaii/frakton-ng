import{b as A,c as b,d as fe,f as ue,g as ge,l as he,m as ve,q as ye,u as we,w as be}from"./chunk-JHRAHIWB.js";import{p as me}from"./chunk-HJNPW7FY.js";import{$ as Y,Ac as w,Bb as oe,Bc as a,Cb as ne,Cc as L,Ib as re,Jb as ie,Lc as pe,Mb as C,N as f,Q as I,S as s,V as q,Vb as H,Wb as se,X as z,Y as K,Yb as ae,_b as le,aa as $,ba as U,bb as j,eb as Z,gb as J,ja as m,jb as ee,ma as D,pb as te,qa as E,sc as ce,ua as X,wa as Q,wc as M,xc as de}from"./chunk-I22COHRS.js";import{a as v,b as W,f as y}from"./chunk-A25UGBQK.js";var h=class i{preventScroll=a(!0);element=s(E).nativeElement;restoreFocusElement=null;selectors=ge();handleTab(e){if(e.key!=="Tab")return;let t=be(Array.from(this.element.querySelectorAll(this.getSelectors())));if(!t.length)return;let o=t[0],n=t[t.length-1];e.shiftKey&&document.activeElement===o?(n.focus({preventScroll:this.preventScroll()}),e.preventDefault()):!e.shiftKey&&document.activeElement===n&&(o.focus({preventScroll:this.preventScroll()}),e.preventDefault())}getSelectors(){return this.selectors.join(", ")}restoreFocus(){this.restoreFocusElement&&this.restoreFocusElement instanceof HTMLElement&&this.restoreFocusElement.focus({preventScroll:this.preventScroll()})}ngAfterViewInit(){this.restoreFocusElement=document.activeElement,setTimeout(()=>{let e=this.element.querySelectorAll(this.getSelectors());e.length&&e[0].focus({preventScroll:this.preventScroll()})},100)}static \u0275fac=function(t){return new(t||i)};static \u0275dir=J({type:i,selectors:[["","fktFocusTrap",""]],hostBindings:function(t,o){t&1&&C("keydown",function(r){return o.handleTab(r)})},inputs:{preventScroll:[1,"preventScroll"]}})};var S=class i{document=s($);appRef=s(te);injector=s(q);createAnchor(e,t,o){let n=pe(e,{elementInjector:o,environmentInjector:this.injector,bindings:A(e,t??{})});this.appRef.attachView(n.hostView);let r=n.hostView.rootNodes[0];return this.document.body.appendChild(r),{componentRef:n,destroy:()=>n.destroy()}}static \u0275fac=function(t){return new(t||i)};static \u0275prov=f({token:i,factory:i.\u0275fac,providedIn:"root"})};var G="fkt-id-sequence",V=class i{platformId=s(X);transferState=s(Q);clientBuffer=null;clientIdx=0;serverCounter=0;next(e){if(me(this.platformId)){let n=`${e}-${this.serverCounter++}`,r=this.transferState.get(G,[]);return this.transferState.set(G,[...r,n]),n}this.clientBuffer||(this.clientBuffer=this.transferState.get(G,[]));let o=this.clientBuffer[this.clientIdx++];return o||`${e}-${Date.now()}-${this.clientIdx++}`}static \u0275fac=function(t){return new(t||i)};static \u0275prov=f({token:i,factory:i.\u0275fac,providedIn:"root"})};var O=new I("window",{factory:()=>window});var B=(i=0)=>{let e=s(U),t=s(O),o=m({x:t.scrollX,y:t.scrollY}),n=we(()=>{o.set({x:t.scrollX,y:t.scrollY})},i),r=()=>{if(i>0)return n();o.set({x:t.scrollX,y:t.scrollY})};return t.addEventListener("scroll",r,!0),e.onDestroy(()=>{t.removeEventListener("scroll",r,!0)}),o.asReadonly()};var x=class i{window=s(O);alignTargetTo(e){let t=typeof e.padding=="number"?e.padding:e.padding?.x??8,o=typeof e.padding=="number"?e.padding:e.padding?.y??8,n=ye[e.position],r=n(e.anchor,e.targetSize),c=0,d=0,l=e.position;return l.startsWith("top")?d=-o:l.startsWith("bottom")&&(d=o),l.startsWith("left")||l.endsWith("left")?c=-t:(l.startsWith("right")||l.endsWith("right"))&&(c=t),{x:r.x+c,y:r.y+d+this.window.scrollY}}smartAlignTargetTo(e){let t=this.calculateBestFit(e);return{position:t,result:this.alignTargetTo(W(v({},e),{position:t}))}}calculateBestFit(e){let t=["bottom-center","bottom-start","bottom-end","top-center","top-start","top-end","left-start","left-center","left-end","right-start","right-center","right-end","bottom-left","bottom-right","top-left","top-right"],o=[...e.preferredPositions??[],...e.disableAutoReposition===!0?[]:t],n=e.container??{x:0,y:0,width:this.window.innerWidth,height:this.window.innerHeight},r=null,c=1/0;for(let d of o){let l=this.alignTargetTo(W(v({},e),{position:d})),P=Math.max(0,l.x+e.targetSize.width-(n.x+n.width)),T=Math.max(0,l.y+e.targetSize.height-(n.y+n.height)),R=Math.max(0,n.x-l.x),p=Math.max(0,n.y-l.y),g=P+T+R+p;if(g===0)return d;g<c&&(c=g,r=d)}return r}static \u0275fac=function(t){return new(t||i)};static \u0275prov=f({token:i,factory:i.\u0275fac,providedIn:"root"})};var F=new I("overlay-info",{factory:()=>({currentPosition:m(null)})});var ke=["container"];function Se(i,e){}var u=class u{id=a.required();stackIndex=a.required();overlayRefs=a.required();anchor=a.required();spacing=a(16);position=a();disableAutoReposition=a();maxHeight=a("300px");minWidth=a("200px");width=a();padding=a();borderRadius=a();backgroundColor=a();overflow=a();boxShadow=a();styles=a({});escapeKeyDown=w();outsideClick=w();closeClick=w();scroll=w();container=L.required("container",{read:j});focusTrap=L.required(h);alignmentService=s(x);overlayInfo=s(F);windowScroll=B();windowScrollChange=de({source:this.windowScroll,computation:(e,t)=>t?e:null});childrenOverlays=M(()=>{let e=this.overlayRefs();return Array.from(e.values()).filter(t=>t.stackIndex>this.stackIndex())});autoCloseOnOutsideClick=fe(e=>{if(!(e instanceof HTMLElement))return;let t=this.anchor().nativeElement,o=this.childrenOverlays().map(r=>r.componentRef.location.nativeElement);[t,...o].some(r=>ue(e,r))||this.outsideClick.emit(e)});autoCloseOnScroll=D(()=>{this.windowScrollChange()!==null&&this.scroll.emit()});elementRef=s(E);sizeSignal=ve(this.elementRef.nativeElement,{startWithNull:!0});canShow=m(!1);internalWidth=M(()=>{let e=this.width();return e||`${this.anchor().nativeElement.getBoundingClientRect().width}px`});alignedPosition=M(()=>{let e=this.anchor();this.windowScroll();let t=e.nativeElement.getBoundingClientRect(),o=this.sizeSignal();return o?this.alignmentService.smartAlignTargetTo({anchor:t,targetSize:o,disableAutoReposition:this.disableAutoReposition()??!1,preferredPositions:[this.position()??"bottom-center"]}):null});updateOverlayInfoPosition=D(()=>{let e=this.alignedPosition();this.overlayInfo.currentPosition.set(e?.position??null)});updateVisibility=D(()=>{this.sizeSignal()&&setTimeout(()=>{this.canShow.set(!0)},100)});restoreFocus(){this.focusTrap().restoreFocus()}static \u0275fac=function(t){return new(t||u)};static \u0275cmp=Z({type:u,selectors:[["fkt-overlay-anchor"]],viewQuery:function(t,o){t&1&&(H(o.container,ke,5,j),H(o.focusTrap,h,5)),t&2&&se(2)},hostVars:23,hostBindings:function(t,o){if(t&2){let n,r;ie("id",o.id()),ae("opacity",o.canShow()?1:0)("left",((n=o.alignedPosition())==null||n.result==null?null:n.result.x)??0,"px")("top",((r=o.alignedPosition())==null||r.result==null?null:r.result.y)??0,"px")("width",o.internalWidth())("--max-height",o.maxHeight())("--padding",o.padding())("--min-width",o.minWidth())("--border-radius",o.borderRadius())("--background-color",o.backgroundColor())("--overflow",o.overflow())("--box-shadow",o.boxShadow())}},inputs:{id:[1,"id"],stackIndex:[1,"stackIndex"],overlayRefs:[1,"overlayRefs"],anchor:[1,"anchor"],spacing:[1,"spacing"],position:[1,"position"],disableAutoReposition:[1,"disableAutoReposition"],maxHeight:[1,"maxHeight"],minWidth:[1,"minWidth"],width:[1,"width"],padding:[1,"padding"],borderRadius:[1,"borderRadius"],backgroundColor:[1,"backgroundColor"],overflow:[1,"overflow"],boxShadow:[1,"boxShadow"],styles:[1,"styles"]},outputs:{escapeKeyDown:"escapeKeyDown",outsideClick:"outsideClick",closeClick:"closeClick",scroll:"scroll"},decls:3,vars:2,consts:[["container",""],["fktFocusTrap","","role","dialog",1,"overlay-container",3,"keydown.esc"]],template:function(t,o){if(t&1){let n=re();oe(0,"div",1),C("keydown.esc",function(c){return z(n),c.stopPropagation(),K(o.escapeKeyDown.emit())}),ee(1,Se,0,0,"ng-template",null,0,ce),ne()}t&2&&le(o.styles())},dependencies:[h],styles:["[_nghost-%COMP%]{position:absolute;height:fit-content;opacity:0}.overlay-container[_ngcontent-%COMP%]{min-width:var(--min-width, 200px);max-height:var(--max-height, 300px);overflow:var(--overflow, auto);background-color:var(--background-color, var(--fkt-color-modal-background));box-shadow:var(--box-shadow, -4px 7px 20px 0px rgba(0, 0, 0, .18));padding:var(--padding);border-radius:var(--border-radius, 10px)}"]})};y([b()],u.prototype,"autoCloseOnOutsideClick",2),y([b()],u.prototype,"autoCloseOnScroll",2),y([b()],u.prototype,"updateOverlayInfoPosition",2),y([b()],u.prototype,"updateVisibility",2);var N=u;var _=class i{anchorService=s(S);overlays=m(new Map);open(e){if(!e.panelOptions?.allowDuplicates){let p=this.findRefByComponent(e.component);if(p)return p}if(e.panelOptions?.id&&!this.canUseId(e.panelOptions.id))throw new Error(`The overlay id "${e.panelOptions.id}" is already in use. Please choose a different id.`);let t=e.panelOptions?.id??this.createId(),o=Y.create({providers:[{provide:F,useValue:{currentPosition:m(null)}}]}),n=()=>{this.overlays().delete(t),e.panelOptions?.focusTriggerOnClose!==!1&&l.componentRef.instance.restoreFocus(),l.destroy(),T.destroy()},r=()=>{e?.panelOptions?.onAutoClose?.(),e?.panelOptions?.disableAutoClose!==!1&&n()},c=this.getLastZIndex()+1,d=e.panelOptions?.styles??{};if(e.panelOptions?.inheritDesignTokensFrom){let p=e?.panelOptions.inheritDesignTokensFrom,g;p instanceof HTMLElement?g=he(p):g=p,d=v(v({},d),g)}let l=this.anchorService.createAnchor(N,{anchor:e.anchorElementRef,id:t,stackIndex:c,overlayRefs:this.overlays,width:e.panelOptions?.width,position:e.panelOptions?.position,padding:e?.panelOptions?.padding,maxHeight:e.panelOptions?.maxHeight??"300px",minWidth:e.panelOptions?.minWidth??"200px",borderRadius:e.panelOptions?.borderRadius??"10px",backgroundColor:e.panelOptions?.backgroundColor,disableAutoReposition:e.panelOptions?.disableAutoReposition??!1,overflow:e.panelOptions?.overflow,boxShadow:e.panelOptions?.boxShadow,styles:d,scroll:()=>{e?.panelOptions?.onScroll?.()},outsideClick:p=>{e?.panelOptions?.onOutsideClick?.(p),r()},escapeKeyDown:()=>{e?.panelOptions?.onEscapeKeyDown?.(),r()}},o),P=l.componentRef.location.nativeElement;P.style.zIndex=c.toString();let T=l.componentRef.instance.container().createComponent(e.component,{bindings:A(e.component,e.data)}),R={componentRef:T,stackIndex:c,close:n};return this.registerOverlay(t,R),R}findRefByComponent(e){return Array.from(this.overlays().values()).find(o=>o.componentRef.componentType===e)}canUseId(e){return!this.overlays().has(e)}registerOverlay(e,t){let o=new Map(this.overlays());o.set(e,t),this.overlays.set(o)}getLastZIndex(){return this.overlays().size+9999}createId(){let e=1,t=`overlay-container-${e}`;for(;!this.canUseId(t);)e++,t=`overlay-container-${e}`;return t}static \u0275fac=function(t){return new(t||i)};static \u0275prov=f({token:i,factory:i.\u0275fac,providedIn:"root"})};export{S as a,V as b,F as c,h as d,_ as e};
