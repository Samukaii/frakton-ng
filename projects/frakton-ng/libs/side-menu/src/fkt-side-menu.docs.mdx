import {Meta, Story, Controls, ArgTypes, Canvas} from '@storybook/addon-docs/blocks';
import * as stories from './fkt-side-menu.stories';

<Meta of={stories} />

# Side Menu

_A responsive and customizable side navigation menu component with collapsible states, grouped menu items, and integrated routing support. Built with Angular signals for optimal performance and provides tooltips for collapsed states._

## Key Features

- **Collapsible Navigation**: Seamless transition between expanded and collapsed states
- **Menu Groups**: Organize navigation items into logical groups with optional headers
- **Router Integration**: Built-in Angular Router support with active state highlighting
- **Tooltip Support**: Contextual tooltips when collapsed for better UX
- **Icon Integration**: Rich icon support using the Frakton icon system
- **Responsive Design**: Adapts to different screen sizes and touch interactions
- **Signal-Based State**: Built with Angular signals for efficient state management
- **Drawer Foundation**: Built on top of the robust FktDrawer component
- **Type Safety**: Full TypeScript support with strongly typed interfaces

## Configuration Options

<ArgTypes/>

### Input Properties
- **`groups`**: `FktMenuGroup[]` - Array of menu groups with their navigation items (required)
- **`opened`**: `ModelSignal<boolean>` - Two-way binding for expanded/collapsed state (default: `true`)

### Types

```typescript
// Core side menu interfaces
interface FktMenuItem {
  name: string;           // Display name for the menu item
  icon: FktIconName;      // Icon identifier from Frakton icon set
  path: string;           // Router path for navigation
}

interface FktMenuGroup {
  name?: string;          // Optional group header text (if omitted, shows divider)
  items: FktMenuItem[];   // Array of menu items in this group
}
```

## Examples

### Basic Side Menu

A simple side menu with a single group of navigation items.

<Canvas className="height-600" of={stories.BasicSideMenu} sourceState="none" />
<p></p>
___
<Controls of={stories.BasicSideMenu} />

```typescript
import { Component, input } from '@angular/core';
import { FktSideMenuComponent } from '../../fkt-side-menu.component';
import { FktMenuGroup } from '../../fkt-side-menu.types';

@Component({
  selector: 'basic-side-menu-example',
  template: `
    <div class="basic-side-menu-example">
      <fkt-side-menu
        [groups]="groups()"
        [opened]="opened()"
      >
        <div class="basic-side-menu-example__content">
          <h1 class="basic-side-menu-example__title">Main Content</h1>
          <p class="basic-side-menu-example__description">This is the main content area. Use the side menu to navigate.</p>
        </div>
      </fkt-side-menu>
    </div>
  `,
  styleUrl: './basic-side-menu-example.component.scss',
  standalone: true,
  imports: [FktSideMenuComponent]
})
export class BasicSideMenuExampleComponent {
  groups = input.required<FktMenuGroup[]>();
  opened = input<boolean>(true);
}
```

### Collapsible Side Menu

Side menu with toggle functionality demonstrating collapsed and expanded states.

<Canvas className="height-600" of={stories.CollapsibleSideMenu} sourceState="none" />
<p></p>
___
<Controls of={stories.CollapsibleSideMenu} />

```typescript
import { Component, input, linkedSignal } from '@angular/core';
import { FktSideMenuComponent } from '../../fkt-side-menu.component';
import { FktMenuGroup } from '../../fkt-side-menu.types';
import { FktButtonComponent } from '../../../button';

@Component({
  selector: 'collapsible-side-menu-example',
  template: `
    <div class="collapsible-side-menu-example">
      <fkt-side-menu
        [groups]="groups()"
        [(opened)]="menuOpened"
      >
        <div class="collapsible-side-menu-example__content">
          <div class="collapsible-side-menu-example__header">
            <h1 class="collapsible-side-menu-example__title">Dashboard</h1>
            <fkt-button
              [text]="menuOpened() ? 'Collapse Menu' : 'Expand Menu'"
              [icon]="menuOpened() ? 'chevron-left' : 'chevron-right'"
              [theme]="'stroked'"
              [color]="'primary'"
              [iconPosition]="menuOpened() ? 'right' : 'left'"
              (click)="toggleMenu()"
            />
          </div>
          <p class="collapsible-side-menu-example__description">
            The side menu is currently <strong>{{ menuOpened() ? 'expanded' : 'collapsed' }}</strong>.
            When collapsed, hover over menu items to see tooltips with their full names.
          </p>
        </div>
      </fkt-side-menu>
    </div>
  `,
  styleUrl: './collapsible-side-menu-example.component.scss',
  standalone: true,
  imports: [FktSideMenuComponent, FktButtonComponent]
})
export class CollapsibleSideMenuExampleComponent {
  groups = input.required<FktMenuGroup[]>();
  opened = input<boolean>(true);

  menuOpened = linkedSignal(this.opened);

  toggleMenu(): void {
    this.menuOpened.update(current => !current);
  }
}
```

### Multi-Group Navigation

Side menu with multiple groups, demonstrating named groups and divider groups.

<Canvas className="height-600" of={stories.MultiGroupSideMenu} sourceState="none" />
<p></p>
___
<Controls of={stories.MultiGroupSideMenu} />

```typescript
import { Component, input } from '@angular/core';
import { FktSideMenuComponent } from '../../fkt-side-menu.component';
import { FktMenuGroup } from '../../fkt-side-menu.types';

@Component({
  selector: 'multi-group-side-menu-example',
  template: `
    <div class="multi-group-side-menu-example">
      <fkt-side-menu
        [groups]="groups()"
        [opened]="opened()"
      >
        <div class="multi-group-side-menu-example__content">
          <h1 class="multi-group-side-menu-example__title">Multi-Section Navigation</h1>
          <p class="multi-group-side-menu-example__description">
            This example shows how to organize menu items into logical groups.
            Groups with names display headers, while groups without names show dividers.
          </p>
        </div>
      </fkt-side-menu>
    </div>
  `,
  styleUrl: './with-routing-example.component.scss',
  standalone: true,
  imports: [FktSideMenuComponent]
})
export class WithRoutingExampleComponent {
  groups = input.required<FktMenuGroup[]>();
  opened = input<boolean>(true);
}
```

### Dynamic Menu with Permissions

Advanced example showing dynamic menu generation based on user permissions.

<Canvas className="height-600" of={stories.DynamicPermissionsSideMenu} sourceState="none" />
<p></p>
___
<Controls of={stories.DynamicPermissionsSideMenu} />

```typescript
import { Component, input, signal, computed } from '@angular/core';
import { FktSideMenuComponent } from '../../fkt-side-menu.component';
import { FktMenuGroup } from '../../fkt-side-menu.types';
import { FktButtonComponent } from '../../../button';

interface UserPermissions {
  canViewAnalytics: boolean;
  canManageUsers: boolean;
  canManageProducts: boolean;
  canViewReports: boolean;
  isAdmin: boolean;
}

@Component({
  selector: 'dynamic-permissions-side-menu-example',
  template: `
    <div class="dynamic-permissions-example">
      <fkt-side-menu
        [groups]="dynamicMenuGroups()"
        [opened]="opened()"
      >
        <div class="dynamic-permissions-example__content">
          <div class="dynamic-permissions-example__controls">
            <h1 class="dynamic-permissions-example__title">User Role: {{ currentRole() }}</h1>
            <div class="dynamic-permissions-example__role-selector">
              <fkt-button
                [text]="'Admin'"
                [theme]="currentRole() === 'Admin' ? 'raised' : 'stroked'"
                [color]="'red'"
                (click)="setRole('admin')"
              />
              <fkt-button
                [text]="'Manager'"
                [theme]="currentRole() === 'Manager' ? 'raised' : 'stroked'"
                [color]="'yellow'"
                (click)="setRole('manager')"
              />
              <fkt-button
                [text]="'User'"
                [theme]="currentRole() === 'User' ? 'raised' : 'stroked'"
                [color]="'green'"
                (click)="setRole('user')"
              />
            </div>
          </div>
          <p class="dynamic-permissions-example__description">
            The menu items change based on the selected user role.
            Switch between roles to see how the navigation adapts dynamically.
          </p>
        </div>
      </fkt-side-menu>
    </div>
  `,
  styleUrl: './dynamic-permissions-side-menu-example.component.scss',
  standalone: true,
  imports: [FktSideMenuComponent, FktButtonComponent]
})
export class DynamicPermissionsSideMenuExampleComponent {
  groups = input.required<FktMenuGroup[]>();
  opened = input<boolean>(true);

  private userRole = signal<'admin' | 'manager' | 'user'>('manager');

  currentRole = computed(() => {
    const role = this.userRole();
    return role.charAt(0).toUpperCase() + role.slice(1);
  });

  userPermissions = computed<UserPermissions>(() => {
    const role = this.userRole();
    switch (role) {
      case 'admin':
        return {
          canViewAnalytics: true,
          canManageUsers: true,
          canManageProducts: true,
          canViewReports: true,
          isAdmin: true
        };
      case 'manager':
        return {
          canViewAnalytics: true,
          canManageUsers: false,
          canManageProducts: true,
          canViewReports: true,
          isAdmin: false
        };
      case 'user':
      default:
        return {
          canViewAnalytics: false,
          canManageUsers: false,
          canManageProducts: false,
          canViewReports: false,
          isAdmin: false
        };
    }
  });

  dynamicMenuGroups = computed<FktMenuGroup[]>(() => {
    const permissions = this.userPermissions();
    const groups: FktMenuGroup[] = [
      {
        name: 'Main',
        items: [
          { name: 'Dashboard', icon: 'home', path: '/dashboard' }
        ]
      }
    ];

    // Add analytics if user can view them
    if (permissions.canViewAnalytics) {
      groups[0].items.push({ name: 'Analytics', icon: 'chart-bar', path: '/analytics' });
    }

    // Add management section if user has management permissions
    if (permissions.canManageUsers || permissions.canManageProducts) {
      const managementItems: any[] = [];

      if (permissions.canManageUsers) {
        managementItems.push({ name: 'Users', icon: 'users', path: '/users' });
      }

      if (permissions.canManageProducts) {
        managementItems.push({ name: 'Products', icon: 'cube', path: '/products' });
      }

      groups.push({
        name: 'Management',
        items: managementItems
      });
    }

    // Add reports for managers and admins
    if (permissions.canViewReports) {
      groups.push({
        name: 'Reports',
        items: [
          { name: 'Sales Report', icon: 'document-chart-bar', path: '/reports/sales' },
          { name: 'User Activity', icon: 'chart-pie', path: '/reports/activity' }
        ]
      });
    }

    // Add admin-only section
    if (permissions.isAdmin) {
      groups.push({
        name: 'System',
        items: [
          { name: 'System Logs', icon: 'document-text', path: '/admin/logs' },
          { name: 'Security', icon: 'shield-check', path: '/admin/security' }
        ]
      });
    }

    // Always add settings at the end (no group name = divider)
    groups.push({
      items: [
        { name: 'Settings', icon: 'cog-6-tooth', path: '/settings' },
        { name: 'Profile', icon: 'user', path: '/profile' }
      ]
    });

    return groups;
  });

  setRole(role: 'admin' | 'manager' | 'user'): void {
    this.userRole.set(role);
  }
}
```

### Admin Dashboard Layout

Complete dashboard layout showcasing real-world usage with content integration.

<Canvas className="height-600" of={stories.AdminDashboardLayout} sourceState="none" />
<p></p>
___
<Controls of={stories.AdminDashboardLayout} />

```typescript
import { Component, input, signal, computed, linkedSignal } from '@angular/core';
import { FktSideMenuComponent } from '../../fkt-side-menu.component';
import { FktMenuGroup } from '../../fkt-side-menu.types';
import { FktButtonComponent } from '../../../button';

@Component({
  selector: 'admin-dashboard-layout-example',
  template: `
    <div class="admin-dashboard-example">
      <fkt-side-menu
        [groups]="groups()"
        [(opened)]="menuOpened"
      >
        <!-- Main Content Area -->
        <div class="admin-dashboard-example__layout">
          <!-- Header -->
          <header class="admin-dashboard-example__header">
            <div class="admin-dashboard-example__header-left">
              <fkt-button
                [icon]="'bars-3'"
                [variant]="'rect'"
                [theme]="'basic'"
                [color]="'primary'"
                (click)="toggleMenu()"
              />
              <h1 class="admin-dashboard-example__title">{{ currentPageTitle() }}</h1>
            </div>
            <div class="admin-dashboard-example__header-right">
              <fkt-button
                [icon]="'bell'"
                [variant]="'rect'"
                [theme]="'basic'"
                [color]="'primary'"
              />
              <div class="admin-dashboard-example__avatar"></div>
            </div>
          </header>

          <!-- Main Content -->
          <main class="admin-dashboard-example__content">
            <div class="admin-dashboard-example__container">
              <div class="admin-dashboard-example__stats">
                <!-- Stats Cards -->
                <div class="admin-dashboard-example__card">
                  <div class="admin-dashboard-example__card-header">
                    <span class="admin-dashboard-example__card-label">Total Users</span>
                    <div class="admin-dashboard-example__card-icon admin-dashboard-example__card-icon--blue">
                      üë•
                    </div>
                  </div>
                  <div class="admin-dashboard-example__card-value">1,249</div>
                  <div class="admin-dashboard-example__card-change admin-dashboard-example__card-change--positive">+12.5% from last month</div>
                </div>

                <div class="admin-dashboard-example__card">
                  <div class="admin-dashboard-example__card-header">
                    <span class="admin-dashboard-example__card-label">Revenue</span>
                    <div class="admin-dashboard-example__card-icon admin-dashboard-example__card-icon--green">
                      üí∞
                    </div>
                  </div>
                  <div class="admin-dashboard-example__card-value">$54,329</div>
                  <div class="admin-dashboard-example__card-change admin-dashboard-example__card-change--positive">+8.2% from last month</div>
                </div>

                <div class="admin-dashboard-example__card">
                  <div class="admin-dashboard-example__card-header">
                    <span class="admin-dashboard-example__card-label">Orders</span>
                    <div class="admin-dashboard-example__card-icon admin-dashboard-example__card-icon--yellow">
                      üì¶
                    </div>
                  </div>
                  <div class="admin-dashboard-example__card-value">328</div>
                  <div class="admin-dashboard-example__card-change admin-dashboard-example__card-change--negative">-2.1% from last month</div>
                </div>
              </div>

              <div class="admin-dashboard-example__activity">
                <h2 class="admin-dashboard-example__activity-title">Recent Activity</h2>
                <div class="admin-dashboard-example__activity-list">
                  <div class="admin-dashboard-example__activity-item">
                    <div class="admin-dashboard-example__activity-indicator admin-dashboard-example__activity-indicator--green"></div>
                    <span class="admin-dashboard-example__activity-text">New user registration: john.doe@example.com</span>
                    <span class="admin-dashboard-example__activity-time">2 minutes ago</span>
                  </div>
                  <div class="admin-dashboard-example__activity-item">
                    <div class="admin-dashboard-example__activity-indicator admin-dashboard-example__activity-indicator--blue"></div>
                    <span class="admin-dashboard-example__activity-text">Order #1248 has been completed</span>
                    <span class="admin-dashboard-example__activity-time">15 minutes ago</span>
                  </div>
                  <div class="admin-dashboard-example__activity-item">
                    <div class="admin-dashboard-example__activity-indicator admin-dashboard-example__activity-indicator--yellow"></div>
                    <span class="admin-dashboard-example__activity-text">Product inventory updated: Wireless Headphones</span>
                    <span class="admin-dashboard-example__activity-time">1 hour ago</span>
                  </div>
                </div>
              </div>
            </div>
          </main>
        </div>
      </fkt-side-menu>
    </div>
  `,
  styleUrl: './admin-dashboard-layout-example.component.scss',
  standalone: true,
  imports: [FktSideMenuComponent, FktButtonComponent]
})
export class AdminDashboardLayoutExampleComponent {
  groups = input.required<FktMenuGroup[]>();
  opened = input<boolean>(true);

  menuOpened = linkedSignal(this.opened);
  private currentPage = signal('dashboard');

  currentPageTitle = computed(() => {
    const page = this.currentPage();
    return page.charAt(0).toUpperCase() + page.slice(1);
  });

  toggleMenu(): void {
    this.menuOpened.update(current => !current);
  }
}
```

### With routing

Complete dashboard layout showcasing real-world usage with content integration.

<Canvas className="height-600" of={stories.WithRouting} sourceState="none" />
<p></p>
___
<Controls of={stories.WithRouting} />

```typescript
import { Component, inject, input } from '@angular/core';
import { FktSideMenuComponent } from '../../fkt-side-menu.component';
import { FktMenuGroup } from '../../fkt-side-menu.types';
import { RouterOutlet, Routes } from '@angular/router';
import { FktButtonComponent } from '../../../button';
import { FktCheckboxComponent } from '../../../checkbox';
import { FktInputComponent } from '../../../input';
import { SignalFormBuilder } from '../../../../form/signal-form-builder';

@Component({
	selector: 'admin-dashboard-page',
	template: `
		<div class="admin-page admin-dashboard">
			<h1 class="admin-page__title">Dashboard</h1>
			<div class="admin-page__content">
				<p class="admin-dashboard__welcome">Bem-vindo ao painel de administra√ß√£o! Aqui voc√™ visualiza m√©tricas e
					acessos r√°pidos.</p>
				<div class="admin-dashboard__stats">
					<div class="admin-dashboard__stat">
						<span class="admin-dashboard__stat-label">Usu√°rios ativos</span>
						<span class="admin-dashboard__stat-value">1.245</span>
					</div>
					<div class="admin-dashboard__stat">
						<span class="admin-dashboard__stat-label">Novos cadastros</span>
						<span class="admin-dashboard__stat-value">38</span>
					</div>
					<div class="admin-dashboard__stat">
						<span class="admin-dashboard__stat-label">Visitas hoje</span>
						<span class="admin-dashboard__stat-value">8.102</span>
					</div>
				</div>
			</div>
		</div>
	`,
	styles: `...`
})
export class AdminDashboardPageComponent {
}

@Component({
	selector: 'admin-users-page',
	template: `
		<div class="admin-page admin-users">
			<h1 class="admin-page__title">Gest√£o de Usu√°rios</h1>
			<div class="admin-page__content">
				<p class="admin-users__subtitle">Acompanhe, edite e remova usu√°rios cadastrados.</p>
				<ul class="admin-users__list">
					<li class="admin-users__item">
						<span class="admin-users__avatar">AB</span>
						<span class="admin-users__name">Ana Beatriz</span>
						<fkt-badge
							text="Administrador"
							color="orange"
						/>
						<fkt-button
							text="Editar"
						/>
					</li>
					<li class="admin-users__item">
						<span class="admin-users__avatar">RF</span>
						<span class="admin-users__name">Rafael Ferreira</span>
						<fkt-badge
							text="Usu√°rio"
							color="blue"
						/>
						<fkt-button
							text="Editar"
						/>
					</li>
					<li class="admin-users__item">
						<span class="admin-users__avatar">JG</span>
						<span class="admin-users__name">Jo√£o Guilherme</span>
						<fkt-badge
							text="Usu√°rio"
							color="blue"
						/>
						<fkt-button
							text="Editar"
						/>
					</li>
				</ul>
			</div>
		</div>
	`,
	imports: [
		FktButtonComponent,
		FktBadgeComponent
	],
	styles: `...`
})
export class AdminUsersPageComponent {
}

@Component({
	selector: 'admin-settings-page',
	template: `
		<div class="admin-page admin-settings">
			<h1 class="admin-page__title">Configura√ß√µes do Sistema</h1>
			<div class="admin-page__content">
				<form class="admin-settings__form">
					<fkt-input
						label="Nome da aplica√ß√£o"
						placeholder="Informe aqui o nome da aplica√ß√£o"
						[control]="form.controls.name"
					/>
					<fkt-checkbox
						label="Modo escuro"
						[control]="form.controls.darkMode"
					/>
					<fkt-button
						type="submit"
						text="Salvar configura√ß√µes"
					/>
				</form>
			</div>
		</div>
	`,
	imports: [
		FktButtonComponent,
		FktCheckboxComponent,
		FktInputComponent
	],
	styles: `...`
})
export class AdminSettingsPageComponent {
	private fb = inject(SignalFormBuilder);

	protected form = this.fb.group({
		name: '',
		darkMode: false,
	})
}


export const WITH_ROUTING_EXAMPLE_ROUTES: Routes = [
	{
		path: "dashboard",
		component: AdminDashboardPageComponent,
	},
	{
		path: "users",
		component: AdminUsersPageComponent,
	},
	{
		path: "settings",
		component: AdminSettingsPageComponent,
	},
	{
		path: "**",
		redirectTo: "dashboard",
	}
];

@Component({
	selector: 'with-routing-example',
	template: `
		<div class="with-routing-example">
			<fkt-side-menu
				[groups]="groups()"
				[opened]="opened()"
			>
				<router-outlet/>
			</fkt-side-menu>
		</div>
	`,
	styleUrl: './with-routing-example.component.scss',
	standalone: true,
	imports: [FktSideMenuComponent, RouterOutlet]
})
export class WithRoutingExampleComponent {
	groups = input.required<FktMenuGroup[]>();
	opened = input<boolean>(true);
}
```

## Use Cases

The Side Menu component is ideal for various navigation scenarios in modern web applications:

### Administrative Dashboards
Perfect for admin panels where users need quick access to management features like user administration, system monitoring, and configuration settings.

### Application Navigation
Excellent for main application navigation in complex apps with multiple sections, providing a persistent navigation structure that doesn't interfere with content.

### Content Management Systems
Great for CMS interfaces where editors need easy access to different content areas, media libraries, and administrative functions.

### E-commerce Platforms
Ideal for merchant dashboards where store owners need to navigate between inventory, orders, customers, and settings efficiently.

### Analytics and Reporting Platforms
Suitable for data-heavy applications where users need to navigate between different report types, dashboards, and data views.

### Multi-tenant Applications
Perfect for SaaS applications where different user roles need access to different features and sections based on their permissions.

## Accessibility

### Keyboard Navigation
- **Tab Navigation**: Full keyboard support for navigating through menu items and interactive elements
- **Enter/Space**: Activates menu items and triggers navigation
- **Escape**: Closes the menu when focused (if applicable)
- **Arrow Keys**: Navigate between menu items within groups

### Screen Reader Support
- **Navigation Landmarks**: Proper nav role and ARIA landmarks for menu structure
- **Menu Semantics**: Proper menubar, menu, and menuitem roles for screen reader understanding
- **State Announcements**: Expanded/collapsed states are announced to assistive technologies
- **Current Page**: Active menu item is properly identified and announced

### Focus Management
- **Logical Order**: Focus flows naturally through menu items and groups
- **Visual Indicators**: Clear focus indicators on all interactive menu items
- **Focus Restoration**: Proper focus management when menu state changes
- **Skip Navigation**: Support for skip-to-content patterns when needed

### ARIA Support
- **Role Attributes**: Proper ARIA roles for navigation and menu structure
- **State Attributes**: Dynamic ARIA states for expanded/collapsed menu
- **Label Associations**: Comprehensive labeling for menu items and groups
- **Current Page**: aria-current attribute for active navigation items

### Tooltip Accessibility
- **Keyboard Access**: Tooltips are accessible via keyboard when menu is collapsed
- **Screen Reader**: Tooltip content is available to screen readers
- **ARIA Descriptions**: Proper aria-describedby associations for tooltip content

### High Contrast Support
- **Color Independence**: Navigation state is conveyed through multiple channels (color, text, icons)
- **Contrast Ratios**: All text and interactive elements meet WCAG contrast requirements
- **System Integration**: Respects user's high contrast mode preferences

## Performance

### Efficient Rendering
- **Angular Signals**: Built with Angular signals for optimal change detection and rendering performance
- **OnPush Strategy**: Uses OnPush change detection for efficient updates
- **Smooth Transitions**: Hardware-accelerated CSS transitions for menu state changes
- **Lazy Loading**: Menu content can be lazily loaded for large navigation structures

### Memory Management
- **Signal Cleanup**: Automatic cleanup of signal subscriptions
- **Event Handling**: Efficient event listener management with proper cleanup
- **Router Integration**: Optimized router link handling without memory leaks

### Bundle Optimization
- **Tree Shakable**: Only used components are included in the final bundle
- **Minimal Dependencies**: Uses only essential Angular and Frakton components
- **Efficient Imports**: Barrel exports for optimal import patterns
- **Icon Optimization**: Icons are loaded efficiently through the Frakton icon system
