import { Meta, Story } from '@storybook/addon-docs/blocks';
import * as fktDatePickerStories from './fkt-date-picker.stories';

<Meta of={fktDatePickerStories} />

The **FktDatePicker** component provides an intuitive and accessible date selection interface. Built with Angular signals and reactive forms, it offers a clean input field with a calendar overlay for date selection.

## Key Features

- **Calendar Interface**: Beautiful calendar modal with month/year navigation
- **Input Field**: Clean text input with automatic date formatting
- **Form Integration**: Seamless integration with SignalFormControl and reactive forms
- **Date Validation**: Built-in validation for date format and validity
- **Keyboard Support**: Full keyboard navigation and accessibility
- **Flexible Positioning**: Smart overlay positioning to avoid viewport overflow
- **Custom Styling**: Consistent design that matches your application theme
- **Locale Support**: Adapts to different date formats and locales

## Basic Usage

```typescript
import { FktDatePickerComponent } from '@frakton-ng/core';
import { SignalFormControl } from '@frakton-ng/core';

@Component({
  selector: 'app-example',
  template: `
    <fkt-date-picker
      [control]="birthDateControl"
      [label]="'Birth Date'"
      [placeholder]="'Select your birth date'"
    />

    <fkt-date-picker
      [control]="dueDateControl"
      [label]="'Due Date'"
      [placeholder]="'mm/dd/yyyy'"
    />
  `,
  standalone: true,
  imports: [FktDatePickerComponent]
})
export class ExampleComponent {
  birthDateControl = new SignalFormControl('');
  dueDateControl = new SignalFormControl(new Date()); // Pre-filled with today
}
```

## Advanced Usage

### With Form Validation
```typescript
import { SignalValidators } from '@frakton-ng/core';

@Component({
  template: `
    <form (ngSubmit)="onSubmit()">
      <fkt-date-picker
        [control]="startDateControl"
        [label]="'Project Start Date'"
        [placeholder]="'Select start date'"
      />

      <fkt-date-picker
        [control]="endDateControl"
        [label]="'Project End Date'"
        [placeholder]="'Select end date'"
      />

      <button type="submit" [disabled]="!isFormValid()">
        Create Project
      </button>
    </form>
  `
})
export class ProjectFormComponent {
  startDateControl = new SignalFormControl('', {
    validators: [SignalValidators.required()]
  });

  endDateControl = new SignalFormControl('', {
    validators: [
      SignalValidators.required(),
      this.validateEndDate.bind(this)
    ]
  });

  isFormValid = computed(() =>
    this.startDateControl.valid() && this.endDateControl.valid()
  );

  validateEndDate(control: any) {
    const startDate = new Date(this.startDateControl.value());
    const endDate = new Date(control.value);

    if (endDate <= startDate) {
      return { endDateInvalid: true };
    }
    return null;
  }

  onSubmit() {
    if (this.isFormValid()) {
      const projectData = {
        startDate: this.startDateControl.value(),
        endDate: this.endDateControl.value()
      };
      console.log('Project created:', projectData);
    }
  }
}
```

### Date Range Selection
```typescript
@Component({
  template: `
    <div class="space-y-4">
      <div class="grid grid-cols-2 gap-4">
        <fkt-date-picker
          [control]="fromDateControl"
          [label]="'From Date'"
          [placeholder]="'Start date'"
        />

        <fkt-date-picker
          [control]="toDateControl"
          [label]="'To Date'"
          [placeholder]="'End date'"
        />
      </div>

      <div class="mt-4">
        <p>Selected Range: {{ getDateRange() }}</p>
        <p>Duration: {{ getDurationInDays() }} days</p>
      </div>
    </div>
  `
})
export class DateRangeComponent {
  fromDateControl = new SignalFormControl('');
  toDateControl = new SignalFormControl('');

  getDateRange = computed(() => {
    const from = this.fromDateControl.value();
    const to = this.toDateControl.value();

    if (!from || !to) return 'Please select both dates';

    return `${new Date(from).toLocaleDateString()} - ${new Date(to).toLocaleDateString()}`;
  });

  getDurationInDays = computed(() => {
    const from = this.fromDateControl.value();
    const to = this.toDateControl.value();

    if (!from || !to) return 0;

    const fromDate = new Date(from);
    const toDate = new Date(to);
    const timeDiff = toDate.getTime() - fromDate.getTime();

    return Math.ceil(timeDiff / (1000 * 3600 * 24));
  });
}
```

### With Custom Date Constraints
```typescript
@Component({
  template: `
    <fkt-date-picker
      [control]="eventDateControl"
      [label]="'Event Date'"
      [placeholder]="'Select event date (future dates only)'"
    />
  `
})
export class EventDateComponent {
  eventDateControl = new SignalFormControl('', {
    validators: [
      SignalValidators.required(),
      this.validateFutureDate.bind(this)
    ]
  });

  validateFutureDate(control: any) {
    const selectedDate = new Date(control.value);
    const today = new Date();
    today.setHours(0, 0, 0, 0); // Reset time to start of day

    if (selectedDate < today) {
      return { pastDate: true };
    }
    return null;
  }
}
```

## Configuration Options

### Input Properties
- **`control`** (required): `SignalFormControl<any>` - Form control managing component state
- **`label`**: `string` - Label text displayed above the input (default: `undefined`)
- **`placeholder`**: `string` - Placeholder text for input field (default: `undefined`)

### Date Format Support
The component supports various date input formats:
- ISO strings: `"2024-12-31"`
- Date objects: `new Date(2024, 11, 31)`
- Formatted strings: `"12/31/2024"`, `"31-12-2024"`

### Calendar Features
- **Month Navigation**: Previous/next month buttons
- **Year Selection**: Click year to open year picker
- **Today Highlight**: Current date is visually highlighted
- **Weekend Styling**: Weekends can have different styling
- **Outside Click**: Calendar closes when clicking outside

## Use Cases

### Event Planning
Perfect for scheduling and event management:
- Meeting scheduling
- Event planning
- Appointment booking
- Deadline setting

### Data Entry
Ideal for forms requiring date input:
- Registration forms
- Profile information
- Transaction records
- Historical data entry

### Filtering and Search
Great for date-based filtering:
- Date range filters
- Report generation
- Data analysis
- Search criteria

### Booking Systems
Essential for reservation systems:
- Hotel bookings
- Flight reservations
- Table reservations
- Service appointments

## Accessibility

- **Keyboard Navigation**: Full keyboard support with arrow keys and Enter/Escape
- **Screen Reader Support**: Proper ARIA labels and calendar structure
- **Focus Management**: Logical focus flow between input and calendar
- **High Contrast**: Supports system high contrast modes
- **Label Association**: Proper label-input relationships
- **Date Announcements**: Selected dates are announced to screen readers

## Browser Support

- **Modern Browsers**: Works in all modern browsers (Chrome, Firefox, Safari, Edge)
- **Date Input Fallback**: Falls back to native date input on unsupported browsers
- **Mobile Friendly**: Optimized for touch interactions on mobile devices
- **Responsive**: Calendar adapts to different screen sizes

## Examples

### Basic Date Picker

Simple date picker with label and placeholder. Click the input field to open the calendar modal.

<Story of={fktDatePickerStories.Default} />

```typescript
@Component({
  selector: 'app-example',
  template: `
    <fkt-date-picker
      [control]="birthDateControl"
      [label]="'Birth Date'"
      [placeholder]="'Select your birth date'"
    />
  `,
  standalone: true,
  imports: [FktDatePickerComponent]
})
export class ExampleComponent {
  birthDateControl = new SignalFormControl('');
}
```

### With Pre-filled Date

Date picker initialized with a specific date value showing the formatted display.

<Story of={fktDatePickerStories.WithPrefilledDate} />

```typescript
@Component({
  selector: 'app-example',
  template: `
    <fkt-date-picker
      [control]="eventDateControl"
      [label]="'Event Date'"
      [placeholder]="'Select event date'"
    />
  `,
  standalone: true,
  imports: [FktDatePickerComponent]
})
export class ExampleComponent {
  eventDateControl = new SignalFormControl(new Date()); // Pre-filled with today's date
}
```

### Required Validation

Date picker with required field validation showing error state when empty.

<Story of={fktDatePickerStories.RequiredField} />

```typescript
import { SignalValidators } from '@frakton-ng/core';

@Component({
  selector: 'app-example',
  template: `
    <fkt-date-picker
      [control]="dueDateControl"
      [label]="'Due Date (Required)'"
      [placeholder]="'Please select a due date'"
    />
    <div class="mt-2 text-sm text-red-600" *ngIf="dueDateControl.invalid() && dueDateControl.touched()">
      This field is required
    </div>
  `,
  standalone: true,
  imports: [FktDatePickerComponent]
})
export class ExampleComponent {
  dueDateControl = new SignalFormControl('', {
    validators: [SignalValidators.required()]
  });
}
```

### Disabled State

Date picker in disabled state prevents user interaction while maintaining visual feedback.

<Story of={fktDatePickerStories.Disabled} />

```typescript
@Component({
  selector: 'app-example',
  template: `
    <fkt-date-picker
      [control]="fixedDateControl"
      [label]="'Fixed Date'"
      [placeholder]="'This date cannot be changed'"
    />
  `,
  standalone: true,
  imports: [FktDatePickerComponent]
})
export class ExampleComponent {
  fixedDateControl = (() => {
    const control = new SignalFormControl(new Date('2024-12-25'));
    control.disable(); // Disable the control
    return control;
  })();
}
```

### Without Label

Date picker without label showing minimal configuration for compact layouts.

<Story of={fktDatePickerStories.WithoutLabel} />

```typescript
@Component({
  selector: 'app-example',
  template: `
    <fkt-date-picker
      [control]="compactDateControl"
      [placeholder]="'mm/dd/yyyy'"
    />
  `,
  standalone: true,
  imports: [FktDatePickerComponent]
})
export class ExampleComponent {
  compactDateControl = new SignalFormControl('');
}
```

### With Format Hint

Date picker with a format hint in the placeholder to guide users on the expected date format.

<Story of={fktDatePickerStories.WithFormatHint} />

```typescript
@Component({
  selector: 'app-example',
  template: `
    <fkt-date-picker
      [control]="formatDateControl"
      [label]="'Start Date'"
      [placeholder]="'DD/MM/YYYY format'"
    />
  `,
  standalone: true,
  imports: [FktDatePickerComponent]
})
export class ExampleComponent {
  formatDateControl = new SignalFormControl('');
}
```
