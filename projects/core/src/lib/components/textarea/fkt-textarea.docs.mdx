import { Meta, Story, Controls, ArgTypes } from '@storybook/addon-docs/blocks';
import * as stories from './fkt-textarea.stories';

<Meta of={stories} />

# FktTextarea

A multi-line text input component with reactive form integration, validation support, and optional auto-expand functionality for capturing longer text content from users._

## Key Features

- **Multi-line Text Input**: Expandable textarea for capturing longer text content
- **Auto-expand Mode**: Automatically adjusts height to fit content (optional)
- **Form Integration**: Seamless integration with Angular reactive forms via SignalFormControl
- **Validation Support**: Built-in error display with customizable validation rules
- **Programmatic Focus**: Public method for focusing the textarea programmatically
- **Disabled State**: Support for disabled/read-only states with visual feedback
- **Responsive Design**: Adapts to container width and screen sizes

## Configuration Options

<ArgTypes/>

### Types

```typescript
// Input types
type control = SignalFormControl<any>; // Required
type label = string; // Required
type placeholder = string; // Optional, default: ''
type autoExpand = boolean; // Optional, default: false

// Method signature
focus(): void; // Programmatically focuses the textarea element
```

## Examples

### Basic Usage

A simple textarea with label and placeholder for capturing user input.

<Story of={stories.Basic} />
<p></p>
___
<Controls of={stories.Basic} />

```ts
import { Component, input } from '@angular/core';
import { FktTextareaComponent } from '../fkt-textarea.component';
import { SignalFormControl } from '../../../form/signal-form-control';

@Component({
	selector: 'textarea-basic-example',
	standalone: true,
	imports: [FktTextareaComponent],
	template: `
		<div class="w-full max-w-md space-y-4">
			<fkt-textarea
				[control]="control()"
				[label]="label()"
				[placeholder]="placeholder()"
			/>
			
			<div class="text-sm text-gray-600">
				<p>Current value: {{ control().value() || '(empty)' }}</p>
			</div>
		</div>
	`
})
export class BasicExampleComponent {
	control = input(new SignalFormControl(''));
	label = input('Description');
	placeholder = input('Enter a detailed description...');
}
```


<Controls of={stories.Basic} />

### Validation

Textarea with validation rules showing real-time error feedback.

<Story of={stories.WithValidation} />
<p></p>
___
<Controls of={stories.WithValidation} />

```ts
import { Component, computed, input } from '@angular/core';
import { FktTextareaComponent } from '../fkt-textarea.component';
import { SignalFormControl } from '../../../form/signal-form-control';
import { SignalValidators } from '../../../form/validators/signal-validators';

@Component({
	selector: 'textarea-validation-example',
	standalone: true,
	imports: [FktTextareaComponent],
	template: `
		<div class="w-full max-w-md space-y-4">
			<fkt-textarea
				[control]="control()"
				[label]="label()"
				[placeholder]="placeholder()"
			/>
			
			<div class="space-y-2">
				<div class="text-sm">
					<span class="font-medium">Status:</span>
					<span [class.text-green-600]="control().valid()"
					      [class.text-red-600]="control().invalid() && control().touched()">
						{{ control().valid() ? 'Valid' : 'Invalid' }}
					</span>
				</div>
				
				<div class="text-sm text-gray-600">
					<p>Character count: {{ characterCount() }}/{{ maxLength() }}</p>
					<p>Required minimum: {{ minLength() }} characters</p>
				</div>
				
				@if (control().errors() && control().touched()) {
					<div class="text-sm text-red-600">
						@if (control().errors()?.['required']) {
							<p>This field is required</p>
						}
						@if (control().errors()?.['minlength']) {
							<p>Minimum {{ minLength() }} characters required (current: {{ characterCount() }})</p>
						}
						@if (control().errors()?.['maxlength']) {
							<p>Maximum {{ maxLength() }} characters allowed (current: {{ characterCount() }})</p>
						}
					</div>
				}
			</div>
		</div>
	`
})
export class ValidationExampleComponent {
	minLength = input(20);
	maxLength = input(500);
	label = input('Bio');
	placeholder = input('Tell us about yourself...');
	
	control = computed(() => {
		return new SignalFormControl('', {
			validators: [
				SignalValidators.required(),
				SignalValidators.minLength(this.minLength()),
				SignalValidators.maxLength(this.maxLength())
			]
		});
	});
	
	characterCount = computed(() => {
		return this.control().value()?.length || 0;
	});
}
```

### Auto-Expand

Textarea that automatically expands its height to fit the content.

<Story of={stories.AutoExpand} />
<p></p>
___
<Controls of={stories.AutoExpand} />

```ts
import { Component, input } from '@angular/core';
import { FktTextareaComponent } from '../fkt-textarea.component';
import { SignalFormControl } from '../../../form/signal-form-control';

@Component({
	selector: 'textarea-auto-expand-example',
	standalone: true,
	imports: [FktTextareaComponent],
	template: `
		<div class="w-full max-w-md space-y-4">
			<div class="text-sm text-gray-600 bg-blue-50 p-3 rounded">
				<p class="font-medium">Auto-expand is {{ autoExpand() ? 'enabled' : 'disabled' }}</p>
				<p>The textarea will {{ autoExpand() ? 'automatically grow' : 'maintain fixed height' }} as you type.</p>
			</div>
			
			<fkt-textarea
				[control]="control()"
				[label]="label()"
				[placeholder]="placeholder()"
				[autoExpand]="autoExpand()"
			/>
			
			<div class="text-sm text-gray-600">
				<p>Try typing multiple lines to see the auto-expand behavior.</p>
				<p>Lines count: {{ lineCount() }}</p>
			</div>
		</div>
	`
})
export class AutoExpandExampleComponent {
	control = input(new SignalFormControl('Type here and press Enter to add new lines.\nThe textarea will automatically expand to fit the content when auto-expand is enabled.'));
	label = input('Notes');
	placeholder = input('Start typing...');
	autoExpand = input(true);
	
	lineCount() {
		const value = this.control().value();
		return value ? value.split('\n').length : 0;
	}
}
```
<Controls of={stories.AutoExpand} />

### Form Integration

Complete form example demonstrating textarea integration with other form fields.

<Story of={stories.FormIntegration} />
<p></p>
___
<Controls of={stories.FormIntegration} />

```ts
import { Component, inject, signal } from '@angular/core';
import { FktTextareaComponent } from '../fkt-textarea.component';
import { FktInputComponent } from '../../input';
import { SignalFormBuilder } from '../../../form/signal-form-builder';
import { SignalValidators } from '../../../form/validators/signal-validators';
import { JsonPipe } from '@angular/common';
import { FktButtonComponent } from '../../button';

@Component({
	selector: 'textarea-form-integration-example',
	standalone: true,
	imports: [FktTextareaComponent, FktInputComponent, JsonPipe, FktButtonComponent],
	template: `
		<div class="w-full space-y-4">
			<h3 class="text-lg font-semibold">Contact Form</h3>

			<form (submit)="handleSubmit($event)" class="space-y-4">
				<div class="grid grid-cols-2 gap-4">
					<fkt-input
						[control]="form.controls.name"
						[label]="'Name'"
						[placeholder]="'Your name'"
						[type]="'text'"
					/>

					<fkt-input
						[control]="form.controls.email"
						[label]="'Email'"
						[placeholder]="'your@email.com'"
						[type]="'email'"
					/>
				</div>

				<fkt-textarea
					[control]="form.controls.message"
					[label]="'Message'"
					[placeholder]="'Please describe your inquiry in detail...'"
				/>

				<fkt-textarea
					[control]="form.controls.additionalInfo"
					[label]="'Additional Information (Optional)'"
					[placeholder]="'Any other details you would like to share...'"
				/>

				<div class="flex justify-between items-center">
					<div class="text-sm text-gray-600">
						<span [class.text-green-600]="form.valid()">
							{{ form.valid() ? '✓ Form is valid' : 'Please fill all required fields' }}
						</span>
					</div>

					<div class="flex gap-2">
						<fkt-button
							(click)="resetForm()"
							text="Reset"
							theme="stroked"
						>
						</fkt-button>
						<fkt-button
							type="submit"
							text="Submit"
							[disabled]="!form.valid()"
						>
						</fkt-button>
					</div>
				</div>
			</form>

			@if (submittedData()) {
				<div class="mt-4 p-4 bg-green-50 border border-green-200 rounded">
					<h4 class="font-medium text-green-800">Form Submitted Successfully!</h4>
					<pre class="mt-2 text-sm text-gray-700">{{ submittedData() | json }}</pre>
				</div>
			}
		</div>
	`
})
export class FormIntegrationExampleComponent {
	private fb = inject(SignalFormBuilder);

	protected form = this.fb.group({
		name: ['', [SignalValidators.required()]],
		email: ['', [SignalValidators.required(), SignalValidators.email()]],
		message: ['', [
			SignalValidators.required(),
			SignalValidators.minLength(10),
			SignalValidators.maxLength(1000)
		]],
		additionalInfo: ''
	});

	submittedData = signal<any>(null);

	handleSubmit(event: Event) {
		event.preventDefault();

		if (this.form.valid()) {
			const formData = {
				...this.form.value(),
				submittedAt: new Date().toISOString()
			};

			this.submittedData.set(formData);

			console.log('Form submitted:', formData);

			setTimeout(() => {
				this.resetForm();
				this.submittedData.set(null);
			}, 3000);
		}
	}

	resetForm() {
		this.form.reset();
		this.submittedData.set(null);
	}
}
```

### Character Counter

Textarea with real-time character counting and limit visualization.

<Story of={stories.CharacterCounter} />
<p></p>

___
<Controls of={stories.CharacterCounter} />

```ts
import { Component, computed, input } from '@angular/core';
import { FktTextareaComponent } from '../fkt-textarea.component';
import { SignalFormControl } from '../../../form/signal-form-control';
import { SignalValidators } from '../../../form/validators/signal-validators';

@Component({
	selector: 'textarea-character-counter-example',
	standalone: true,
	imports: [FktTextareaComponent],
	template: `
		<div class="w-full space-y-4">
			<fkt-textarea
				class="w-full"
				autoExpand
				[control]="control"
				[label]="label()"
				[placeholder]="placeholder()"
			/>

			<div class="space-y-2">
				<!-- Character counter -->
				<div class="flex justify-between items-center">
					<span class="text-sm text-gray-600">Character count:</span>
					<span
						class="text-sm font-medium"
						[class.text-gray-700]="characterCount() <= warningThreshold()"
						[class.text-yellow-600]="characterCount() > warningThreshold() && characterCount() <= maxLength()"
						[class.text-red-600]="characterCount() > maxLength()"
					>
						{{ characterCount() }} / {{ maxLength() }}
					</span>
				</div>

				<!-- Progress bar -->
				<div class="w-full bg-gray-200 rounded-full h-2">
					<div
						class="h-2 rounded-full transition-all duration-300"
						[class.bg-green-500]="characterCount() <= warningThreshold()"
						[class.bg-yellow-500]="characterCount() > warningThreshold() && characterCount() <= maxLength()"
						[class.bg-red-500]="characterCount() > maxLength()"
						[style.width.%]="progressPercentage()"
					></div>
				</div>

				<!-- Stats -->
				<div class="grid grid-cols-3 gap-2 text-xs text-gray-600">
					<div>
						<span class="font-medium">Words:</span> {{ wordCount() }}
					</div>
					<div>
						<span class="font-medium">Lines:</span> {{ lineCount() }}
					</div>
					<div>
						<span class="font-medium">Remaining:</span> {{ remainingCharacters() }}
					</div>
				</div>

				<!-- Warning messages -->
				@if (characterCount() > warningThreshold()) {
					<div class="text-sm">
						@if (characterCount() <= maxLength()) {
							<p class="text-yellow-600">⚠️ You're approaching the character limit</p>
						}
						@if (characterCount() > maxLength()) {
							<p class="text-red-600">❌ Character limit exceeded by {{ characterCount() - maxLength() }} characters</p>
						}
					</div>
				}
			</div>
		</div>
	`
})
export class CharacterCounterExampleComponent {
	maxLength = input(280); // Twitter-like limit
	warningThreshold = computed(() => Math.floor(this.maxLength() * 0.8));
	label = input('Tweet');
	placeholder = input("What's happening?");

	protected control = new SignalFormControl<string>('', {
		validators: [
			SignalValidators.maxLength(this.maxLength())
		]
	});

	protected characterCount = computed(() => {
		const value = this.control.value();
		return value?.length || 0;
	});

	protected wordCount = computed(() => {
		const value = this.control.value();
		if (!value) return 0;
		const text = value.trim();
		return text ? text.split(/\s+/).length : 0;
	});

	protected lineCount = computed(() => {
		const value = this.control.value();
		if (!value) return 1;
		return value.split('\n').length;
	});

	protected remainingCharacters = computed(() => {
		const remaining = this.maxLength() - this.characterCount();
		return remaining >= 0 ? remaining : 0;
	});

	protected progressPercentage = computed(() => {
		const percentage = (this.characterCount() / this.maxLength()) * 100;
		return Math.min(percentage, 100);
	});
}
```

### Disabled State

Textarea in disabled/read-only state with toggle functionality.

<Story of={stories.DisabledState} />
<p></p>

___
<Controls of={stories.DisabledState} />

```ts
import { Component, computed, input, OnInit } from '@angular/core';
import { FktTextareaComponent } from '../fkt-textarea.component';
import { SignalFormControl } from '../../../form/signal-form-control';
import { FktButtonComponent } from '../../button';

@Component({
	selector: 'textarea-disabled-example',
	standalone: true,
	imports: [FktTextareaComponent, FktButtonComponent],
	template: `
		<div class="w-full space-y-4">
			<fkt-textarea
				autoExpand
				[control]="control"
				[label]="label()"
				[placeholder]="placeholder()"
			/>

			<div class="flex items-center space-x-4">
				<fkt-button
					(click)="toggleDisabled()"
					[text]="(control.disabled() ? 'Enable' : 'Disable') + ' textarea'"
				>
				</fkt-button>

				<span class="text-sm text-gray-600">
					Status: <strong>{{ control.disabled() ? 'Disabled' : 'Enabled' }}</strong>
				</span>
			</div>

			<div class="text-sm text-gray-600">
				<p>Disabled textareas prevent user interaction while preserving the current value.</p>
				<p>Common use cases include read-only views, locked fields, or conditional editing.</p>
			</div>
		</div>
	`
})
export class DisabledExampleComponent implements OnInit {
	label = input('Terms and Conditions');
	placeholder = input('Content will appear here...');
	initialDisabled = input(true);

	control = new SignalFormControl(`
This is a sample legal text that cannot be edited by the user.
By using our service, you agree to these terms and conditions. This text field is disabled to prevent modifications to the legal agreement.
The disabled state is useful for displaying read-only content while maintaining the form field structure.`.trim()
	);

	ngOnInit() {
		this.control.disable();
	}

	toggleDisabled() {
		if (this.control.disabled()) {
			this.control.enable();
		} else {
			this.control.disable();
		}
	}
}
```

## Use Cases

- **Contact Forms**: Capture detailed messages and inquiries from users
- **Content Management**: Create and edit articles, blog posts, and documentation
- **Feedback Collection**: Gather user reviews, comments, and suggestions
- **Data Entry**: Input descriptions, notes, and multi-line data in business applications
- **Social Media**: Compose posts, tweets, and status updates with character limits
- **Code Editors**: Input and display code snippets with proper formatting
- **Support Tickets**: Describe issues and provide detailed problem reports

## Accessibility

- **Keyboard Navigation**: Full keyboard support with Tab for focus and standard text navigation
- **Screen Reader Support**: Proper ARIA labels and error announcements
- **Focus Management**: Clear visual focus indicators and programmatic focus control via the `focus()` method
- **Error Communication**: Validation errors are properly associated with the textarea and announced to assistive technologies
