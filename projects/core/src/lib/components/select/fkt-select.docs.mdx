import { Meta, Story, Controls, ArgTypes } from '@storybook/addon-docs/blocks';
import * as stories from './fkt-select.stories';

<Meta of={stories} />

# FktSelect

_A dropdown selection component that provides a clean and accessible interface for choosing options. Built with Angular signals and reactive forms, it offers a styled alternative to native select elements with enhanced functionality and consistent design._

## Key Features

- **Custom Styling**: Beautiful dropdown design that works consistently across all browsers
- **Form Integration**: Seamless integration with SignalFormControl and reactive forms
- **Keyboard Navigation**: Full keyboard support for accessibility and efficiency
- **Loading States**: Built-in support for dynamic option loading with loading indicators
- **Custom No Results**: Configurable messaging when no options are available
- **Async Loading**: Support for loading options dynamically from APIs

## Configuration Options

<ArgTypes/>

### Types

```typescript
// Option interface
interface FktSelectOption {
  value: string | number;
  label: string;
}

// No results configuration
interface FktNoResults {
  label: string;
  icon?: { name: FktIconName; size?: string };
  description?: string;
  action?: FktButtonAction;
}
```

## Examples

### Basic Select

Simple dropdown with a list of predefined options. Click to open and select an option.

<Story of={stories.Default} />
___
<Controls of={stories.Default} />

```ts
import { Component, input } from '@angular/core';
import { FktSelectComponent } from '../fkt-select.component';
import { SignalFormControl } from '../../../form/signal-form-control';
import { FktSelectOption } from '../fkt-select.types';

@Component({
  selector: 'select-default-example',
  template: `
    <fkt-select
      [control]="control"
      [label]="label()"
      [placeholder]="placeholder()"
      [options]="options()"
      [loading]="loading()"
      [noResults]="noResults()"
    />
    <div class="mt-4 p-4 bg-blue-50 text-sm text-blue-900 rounded">
      <strong>Selected Value:</strong> {{ control.value() || 'None' }}
    </div>
  `,
  standalone: true,
  imports: [FktSelectComponent]
})
export class DefaultExampleComponent {
  control = new SignalFormControl('');
  label = input<string>();
  placeholder = input<string>();
  options = input.required<FktSelectOption[]>();
  loading = input<boolean>(false);
  noResults = input<any>();
}
```

### Pre-selected Option

Select dropdown with an initial selected value showing the selected state.

<Story of={stories.WithPreselected} />
___
<Controls of={stories.WithPreselected} />

```ts
import { Component, input, computed } from '@angular/core';
import { FktSelectComponent } from '../fkt-select.component';
import { SignalFormControl } from '../../../form/signal-form-control';
import { FktSelectOption } from '../fkt-select.types';

@Component({
  selector: 'select-preselected-example',
  template: `
    <fkt-select
      [control]="control"
      [label]="label()"
      [placeholder]="placeholder()"
      [options]="options()"
    />
    <div class="mt-4 p-4 bg-blue-50 text-blue-900 text-sm rounded">
      <strong>Pre-selected Country:</strong> {{ selectedLabel() }}
    </div>
  `,
  standalone: true,
  imports: [FktSelectComponent]
})
export class PreselectedExampleComponent {
  control = new SignalFormControl('us'); // Pre-selected value
  label = input<string>();
  placeholder = input<string>();
  options = input.required<FktSelectOption[]>();

  selectedLabel = computed(() => {
    const value = this.control.value();
    const option = this.options().find(opt => opt.value === value);
    return option ? option.label : 'None';
  });
}
```

### Large Option List

Select with many options demonstrating scrollable dropdown behavior.

<Story of={stories.WithLargeList} />
___
<Controls of={stories.WithLargeList} />

```ts
import { Component, input } from '@angular/core';
import { FktSelectComponent } from '../fkt-select.component';
import { SignalFormControl } from '../../../form/signal-form-control';
import { FktSelectOption } from '../fkt-select.types';

@Component({
  selector: 'select-large-list-example',
  template: `
    <fkt-select
      [control]="control"
      [label]="label()"
      [placeholder]="placeholder()"
      [options]="options()"
    />
    <div class="mt-4 p-4 bg-blue-50 text-blue-900 text-sm rounded">
      <p>
        Scrollable dropdown with {{ options().length }} options
      </p>
      <p class="mt-2">
        <strong>Selected:</strong> {{ control.value() || 'None' }}
      </p>
    </div>
  `,
  standalone: true,
  imports: [FktSelectComponent]
})
export class LargeListExampleComponent {
  control = new SignalFormControl('');
  label = input<string>();
  placeholder = input<string>();
  options = input.required<FktSelectOption[]>();
}
```

### Loading State

Select showing loading indicator while options are being fetched.

<Story of={stories.Loading} />
___
<Controls of={stories.Loading} />

```ts
import { Component, input } from '@angular/core';
import { FktSelectComponent } from '../fkt-select.component';
import { SignalFormControl } from '../../../form/signal-form-control';
import { FktSelectOption } from '../fkt-select.types';

@Component({
  selector: 'select-loading-example',
  template: `
    <fkt-select
      [control]="control"
      [label]="label()"
      [placeholder]="placeholder()"
      [options]="options()"
      [loading]="loading()"
    />
    <div class="mt-4 p-4 bg-blue-50 text-blue-900 text-sm rounded">
      <p>
        <strong>Loading State:</strong> {{ loading() ? 'Loading options...' : 'Ready' }}
      </p>
    </div>
  `,
  standalone: true,
  imports: [FktSelectComponent]
})
export class LoadingExampleComponent {
  control = new SignalFormControl('');
  label = input<string>();
  placeholder = input<string>();
  options = input.required<FktSelectOption[]>();
  loading = input<boolean>(true);
}
```

### Empty State

Select with no options showing custom "no results" message.

<Story of={stories.EmptyState} />
___
<Controls of={stories.EmptyState} />

```ts
import { Component, input } from '@angular/core';
import { FktSelectComponent } from '../fkt-select.component';
import { SignalFormControl } from '../../../form/signal-form-control';
import { FktSelectOption } from '../fkt-select.types';
import { FktNoResults } from '../../no-results';

@Component({
  selector: 'select-empty-state-example',
  template: `
    <fkt-select
      [control]="control"
      [label]="label()"
      [placeholder]="placeholder()"
      [options]="options()"
      [loading]="loading()"
      [noResults]="noResults()!"
    />
    <div class="mt-4 p-4 bg-blue-50 rounded">
      <p class="text-sm text-blue-900">
        Click the dropdown to see the custom "no results" message
      </p>
    </div>
  `,
  standalone: true,
  imports: [FktSelectComponent]
})
export class EmptyStateExampleComponent {
  control = new SignalFormControl('');
  label = input<string>();
  placeholder = input<string>();
  options = input.required<FktSelectOption[]>();
  loading = input<boolean>(false);
  noResults = input<FktNoResults>();
}
```

### With Validation

Select with required validation showing error state when no option is selected.

<Story of={stories.WithValidation} />
___
<Controls of={stories.WithValidation} />

```ts
import { Component, input } from '@angular/core';
import { FktSelectComponent } from '../fkt-select.component';
import { SignalFormControl } from '../../../form/signal-form-control';
import { SignalValidators } from '../../../form/validators/signal-validators';
import { FktSelectOption } from '../fkt-select.types';

@Component({
  selector: 'select-validation-example',
  template: `
    <fkt-select
      [control]="control"
      [label]="label()"
      [placeholder]="placeholder()"
      [options]="options()"
    />
    <div class="mt-4 p-4 bg-blue-50 rounded">
      <p class="text-sm text-blue-900">
        <strong>Validation Status:</strong>
        {{ control.valid() ? 'Valid âœ“' : 'Invalid - Priority is required' }}
      </p>
      <div
        class="mt-2 text-sm font-semibold text-blue-900"
      >
        Touch field and click outside to Show Error
      </div>
    </div>
  `,
  standalone: true,
  imports: [FktSelectComponent]
})
export class ValidationExampleComponent {
  control = new SignalFormControl('', {
    validators: [SignalValidators.required()]
  });
  label = input<string>();
  placeholder = input<string>();
  options = input.required<FktSelectOption[]>();
}
```

### Disabled State

Select in disabled state preventing user interaction while maintaining visual feedback.

<Story of={stories.Disabled} />
___
<Controls of={stories.Disabled} />

```ts
import { Component, input, OnInit } from '@angular/core';
import { FktSelectComponent } from '../fkt-select.component';
import { SignalFormControl } from '../../../form/signal-form-control';
import { FktSelectOption } from '../fkt-select.types';
import { FktButtonComponent } from '../../button';

@Component({
  selector: 'select-disabled-example',
  template: `
	  <fkt-select
		  [control]="control"
		  [label]="label()"
		  [placeholder]="placeholder()"
		  [options]="options()"
	  />
	  <fkt-button
		  class="w-fit my-4"
		  (click)="toggleDisabled()"
		  theme="stroked"
		  [text]="control.disabled() ? 'Enable field' : 'Disable field'"
	  >
	  </fkt-button>
  `,
  standalone: true,
	imports: [FktSelectComponent, FktButtonComponent]
})
export class DisabledExampleComponent implements OnInit {
  control = new SignalFormControl('option2');
  label = input<string>();
  placeholder = input<string>();
  options = input.required<FktSelectOption[]>();

  ngOnInit() {
    this.control.disable();
  }

  toggleDisabled() {
    if (this.control.disabled()) {
      this.control.enable();
    } else {
      this.control.disable();
    }
  }
}
```

### Async Loading

Select that loads options asynchronously with simulated API delay.

<Story of={stories.AsyncLoading} />
___
<Controls of={stories.AsyncLoading} />

```ts
import { Component, signal, input } from '@angular/core';
import { FktSelectComponent } from '../fkt-select.component';
import { SignalFormControl } from '../../../form/signal-form-control';
import { FktSelectOption } from '../fkt-select.types';

@Component({
  selector: 'select-async-loading-example',
  template: `
	  <div>
		  <div class="flex flex-col gap-2 p-4 bg-blue-50 text-blue-900 text-sm rounded">
			  <strong>
				  Click field to load users
			  </strong>
			  <p class="text-sm">
				  <strong>Status:</strong>
				  {{ loading() ? 'Loading users from API...' : 'Users loaded successfully' }}
			  </p>
		  </div>
		  <fkt-select
			  [control]="control"
			  (selectOpened)="loadOptions()"
			  [label]="label()"
			  [placeholder]="placeholder()"
			  [options]="options()"
			  [loading]="loading()"
		  />
	  </div>
  `,
  standalone: true,
  imports: [FktSelectComponent]
})
export class AsyncLoadingExampleComponent {
  control = new SignalFormControl('');
  label = input<string>();
  placeholder = input<string>();
  options = signal<FktSelectOption[]>([]);
  loading = signal(false);

  async loadOptions() {
    this.loading.set(true);
    this.options.set([]);

    // Simulate API call
    await new Promise(resolve => setTimeout(resolve, 2000));

    const users: FktSelectOption[] = [
      { value: 'user1', label: 'John Doe' },
      { value: 'user2', label: 'Jane Smith' },
      { value: 'user3', label: 'Bob Johnson' },
      { value: 'user4', label: 'Alice Williams' },
      { value: 'user5', label: 'Charlie Brown' },
    ];

    this.options.set(users);
    this.loading.set(false);
  }
}
```

## Use Cases

[Real-world application scenarios where the FktSelect component provides value]

- **Form Selection**: Country/region selection, status and priority selection, user and role assignment
- **Configuration Settings**: Theme and appearance options, language and locale selection, feature toggles
- **Data Filtering**: Sort order selection, filter criteria selection, date range presets
- **Business Applications**: Department and team selection, project status and priority, customer and vendor selection

## Accessibility

- **Keyboard Navigation**: Arrow keys navigate options, Enter selects, Escape closes dropdown, Tab moves focus
- **Screen Reader Support**: ARIA labels for combobox role, aria-expanded state, aria-activedescendant for highlighted option
- **Focus Management**: Logical tab order, visible focus indicators, focus trap when dropdown is open
- **Other Notes**: Supports high contrast mode, respects prefers-reduced-motion for animations
