{"version":3,"file":"frakton-ng-internal-services.mjs","sources":["../../internal/services/element-anchor/fkt-element-anchor.service.ts","../../internal/services/element-id-generator/element-id-generator.service.ts","../../internal/services/geometry-alignment/fkt-geometry-alignment.service.ts","../../internal/services/frakton-ng-internal-services.ts"],"sourcesContent":["import {\r\n\tApplicationRef,\r\n\tComponentRef,\r\n\tcreateComponent,\r\n\tDOCUMENT,\r\n\tEnvironmentInjector,\r\n\tinject,\r\n\tInjectable,\r\n\tInjector,\r\n\tType,\r\n} from '@angular/core';\r\nimport { createComponentBindings } from 'frakton-ng/internal/utils';\r\nimport { FktReactiveComponentData } from 'frakton-ng/internal/types';\r\n\r\n\r\n@Injectable({providedIn: 'root'})\r\nexport class FktElementAnchorService {\r\n\tprivate document = inject(DOCUMENT);\r\n\r\n\tprivate zIndex = 9999;\r\n\r\n\tconstructor(\r\n\t\tprivate appRef: ApplicationRef,\r\n\t\tprivate injector: EnvironmentInjector\r\n\t) {\r\n\t}\r\n\r\n\tcreateAnchor<T>(component: Type<T>, options?: Partial<FktReactiveComponentData<T>>, injector?: Injector) {\r\n\t\tconst componentRef = createComponent(component, {\r\n\t\t\telementInjector: injector,\r\n\t\t\tenvironmentInjector: this.injector,\r\n\t\t\tbindings: createComponentBindings(component, options ?? {})\r\n\t\t});\r\n\r\n\t\tthis.appRef.attachView(componentRef.hostView);\r\n\r\n\t\tconst el = (componentRef.hostView as any).rootNodes[0] as HTMLElement;\r\n\t\tthis.document.body.appendChild(el);\r\n\r\n\t\tconst element = componentRef.location.nativeElement as HTMLElement;\r\n\t\telement.style.zIndex = `${this.getZIndex()}`\r\n\r\n\t\treturn { componentRef, destroy: () => this.destroy(componentRef), zIndex: this.getZIndex() };\r\n\t}\r\n\r\n\tprivate getZIndex() {\r\n\t\tthis.zIndex++;\r\n\r\n\t\treturn this.zIndex;\r\n\t}\r\n\r\n\tprivate destroy(ref: ComponentRef<any>) {\r\n\t\tref.destroy();\r\n\t\tthis.zIndex--;\r\n\t}\r\n}\r\n","import { Injectable, inject, PLATFORM_ID, TransferState, makeStateKey } from '@angular/core';\r\nimport { isPlatformServer } from '@angular/common';\r\n\r\nconst KEY = makeStateKey<string[]>('fkt-id-sequence');\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class ElementIdGeneratorService {\r\n\tprivate platformId = inject(PLATFORM_ID);\r\n\tprivate transferState = inject(TransferState);\r\n\r\n\tprivate clientBuffer: string[] | null = null;\r\n\tprivate clientIdx = 0;\r\n\tprivate serverCounter = 0;\r\n\r\n\tnext(prefix: string): string {\r\n\t\tconst isServer = isPlatformServer(this.platformId);\r\n\r\n\t\tif (isServer) {\r\n\t\t\tconst id = `${prefix}-${this.serverCounter++}`;\r\n\t\t\tconst sequence = this.transferState.get(KEY, []);\r\n\t\t\tthis.transferState.set(KEY, [...sequence, id]);\r\n\t\t\treturn id;\r\n\t\t}\r\n\r\n\t\tif (!this.clientBuffer) this.clientBuffer = this.transferState.get(KEY, []);\r\n\t\tconst fromSSR = this.clientBuffer[this.clientIdx++];\r\n\t\tif (fromSSR) return fromSSR;\r\n\r\n\t\treturn `${prefix}-${Date.now()}-${this.clientIdx++}`;\r\n\t}\r\n}\r\n","import { inject, Injectable } from '@angular/core';\r\nimport { geometryPositionCalculations } from 'frakton-ng/internal/utils';\r\nimport { FktAlignTargetToOptions } from './models/fkt-align-target-to.options';\r\nimport { FktSmartAlignTargetToOptions } from './models/fkt-smart-align-target-to.options';\r\nimport { WINDOW } from 'frakton-ng/internal/di';\r\nimport { FktGeometryPosition } from 'frakton-ng/internal/types';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FktGeometryAlignmentService {\r\n\tprivate window = inject(WINDOW);\r\n\r\n\talignTargetTo(options: FktAlignTargetToOptions) {\r\n\t\tconst paddingX = typeof options.padding === 'number'\r\n\t\t\t? options.padding\r\n\t\t\t: options.padding?.x ?? 8;\r\n\r\n\t\tconst paddingY = typeof options.padding === 'number'\r\n\t\t\t? options.padding\r\n\t\t\t: options.padding?.y ?? 8;\r\n\r\n\t\tconst aligner = geometryPositionCalculations[options.position];\r\n\t\tconst base = aligner(options.anchor, options.targetSize);\r\n\r\n\t\tlet offsetX = 0;\r\n\t\tlet offsetY = 0;\r\n\r\n\t\tconst pos = options.position;\r\n\r\n\t\tif (pos.startsWith('top')) offsetY = -paddingY;\r\n\t\telse if (pos.startsWith('bottom')) offsetY = paddingY;\r\n\r\n\t\tif (pos.startsWith('left') || pos.endsWith('left')) offsetX = -paddingX;\r\n\t\telse if (pos.startsWith('right') || pos.endsWith('right')) offsetX = paddingX;\r\n\r\n\t\treturn {\r\n\t\t\tx: base.x + offsetX,\r\n\t\t\ty: base.y + offsetY + this.window.scrollY,\r\n\t\t};\r\n\t};\r\n\r\n\tsmartAlignTargetTo(options: FktSmartAlignTargetToOptions) {\r\n\t\tconst bestFit = this.calculateBestFit(options);\r\n\r\n\t\treturn {\r\n\t\t\tposition: bestFit,\r\n\t\t\tresult: this.alignTargetTo({\r\n\t\t\t\t...options,\r\n\t\t\t\tposition: bestFit\r\n\t\t\t})\r\n\t\t};\r\n\t};\r\n\r\n\tprivate calculateBestFit(options: FktSmartAlignTargetToOptions) {\r\n\t\tconst defaultPositions: FktGeometryPosition[] = [\r\n\t\t\t'bottom-center',\r\n\t\t\t'bottom-start',\r\n\t\t\t'bottom-end',\r\n\r\n\t\t\t'top-center',\r\n\t\t\t'top-start',\r\n\t\t\t'top-end',\r\n\r\n\t\t\t'left-start',\r\n\t\t\t'left-center',\r\n\t\t\t'left-end',\r\n\r\n\t\t\t'right-start',\r\n\t\t\t'right-center',\r\n\t\t\t'right-end',\r\n\r\n\t\t\t'bottom-left',\r\n\t\t\t'bottom-right',\r\n\t\t\t'top-left',\r\n\t\t\t'top-right',\r\n\t\t]\r\n\r\n\t\tconst positions = [\r\n\t\t\t...(options.preferredPositions ?? []),\r\n\t\t\t...(options.disableAutoReposition === true ? [] : defaultPositions)\r\n\t\t];\r\n\r\n\t\tconst container = options.container ?? {\r\n\t\t\tx: 0,\r\n\t\t\ty: 0,\r\n\t\t\twidth: this.window.innerWidth,\r\n\t\t\theight: this.window.innerHeight\r\n\t\t};\r\n\r\n\t\tlet bestFit = null;\r\n\t\tlet smallestOverflow = Infinity;\r\n\r\n\t\tfor (const position of positions) {\r\n\t\t\tconst result = this.alignTargetTo({\r\n\t\t\t\t...options,\r\n\t\t\t\tposition\r\n\t\t\t});\r\n\r\n\t\t\tconst rightOverflow = Math.max(0, result.x + options.targetSize.width - (container.x + container.width));\r\n\t\t\tconst bottomOverflow = Math.max(0, result.y + options.targetSize.height - (container.y + container.height));\r\n\t\t\tconst leftOverflow = Math.max(0, container.x - result.x);\r\n\t\t\tconst topOverflow = Math.max(0, container.y - result.y);\r\n\r\n\t\t\tconst totalOverflow = rightOverflow + bottomOverflow + leftOverflow + topOverflow;\r\n\r\n\t\t\tif (totalOverflow === 0) {\r\n\t\t\t\treturn position;\r\n\t\t\t}\r\n\r\n\t\t\tif (totalOverflow < smallestOverflow) {\r\n\t\t\t\tsmallestOverflow = totalOverflow;\r\n\t\t\t\tbestFit = position;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn bestFit!;\r\n\t}\r\n}\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}